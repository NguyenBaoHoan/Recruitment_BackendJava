# üöÄ H∆Ø·ªöNG D·∫™N T√çCH H·ª¢P GITHUB V√Ä FACEBOOK OAUTH2 LOGIN

## üìã M·ª§C L·ª§C
1. [T·ªïng quan v·ªÅ m·ª•c ti√™u](#1-t·ªïng-quan-v·ªÅ-m·ª•c-ti√™u)
2. [Chu·∫©n b·ªã tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu](#2-chu·∫©n-b·ªã-tr∆∞·ªõc-khi-b·∫Øt-ƒë·∫ßu)
3. [C√°c b∆∞·ªõc chi ti·∫øt](#3-c√°c-b∆∞·ªõc-chi-ti·∫øt)
4. [Lu·ªìng ho·∫°t ƒë·ªông c·ªßa OAuth2](#4-lu·ªìng-ho·∫°t-ƒë·ªông-c·ªßa-oauth2)
5. [T·ªïng k·∫øt c√°c file ƒë√£ s·ª≠a ƒë·ªïi](#5-t·ªïng-k·∫øt-c√°c-file-ƒë√£-s·ª≠a-ƒë·ªïi)

---

## 1. T·ªîNG QUAN V·ªÄ M·ª§C TI√äU

### üéØ M·ª•c ti√™u l·ªõn
Th√™m t√≠nh nƒÉng ƒëƒÉng nh·∫≠p b·∫±ng **GitHub** v√† **Facebook** v√†o h·ªá th·ªëng hi·ªán t·∫°i, d·ª±a tr√™n logic Google OAuth2 ƒë√£ c√≥ s·∫µn.

### üìä Ph√¢n t√≠ch hi·ªán tr·∫°ng
B·∫°n ƒë√£ c√≥:
- ‚úÖ Google OAuth2 login ho√†n ch·ªânh
- ‚úÖ SecurityConfiguration v·ªõi oauth2Login
- ‚úÖ AuthService v·ªõi ph∆∞∆°ng th·ª©c `registerOauthUser()`
- ‚úÖ HttpCookieOAuth2AuthorizationRequestRepository
- ‚úÖ Success/Failure handlers
- ‚úÖ Frontend OAuthButtons component
- ‚úÖ Frontend oauth.config.jsx

### üéØ M·ª•c ti√™u chi ti·∫øt

#### **M·ª•c ti√™u 1: ƒêƒÉng k√Ω ·ª©ng d·ª•ng v·ªõi GitHub v√† Facebook**
- T·∫°o GitHub OAuth App
- T·∫°o Facebook App
- L·∫•y Client ID v√† Client Secret

#### **M·ª•c ti√™u 2: C·∫•u h√¨nh Backend**
- Th√™m GitHub v√† Facebook v√†o `application.properties`
- Kh√¥ng c·∫ßn s·ª≠a SecurityConfiguration (ƒë√£ h·ªó tr·ª£ multi-provider)

#### **M·ª•c ti√™u 3: X·ª≠ l√Ω d·ªØ li·ªáu t·ª´ providers**
- GitHub tr·∫£ v·ªÅ `login`, `name`, `email`
- Facebook tr·∫£ v·ªÅ `id`, `name`, `email`
- Mapping th·ªëng nh·∫•t sang User entity

#### **M·ª•c ti√™u 4: C·∫≠p nh·∫≠t Frontend**
- Frontend ƒë√£ s·∫µn s√†ng (oauth.config.jsx ƒë√£ c√≥ GitHub v√† Facebook)
- Ch·ªâ c·∫ßn ƒë·∫£m b·∫£o authUrl ƒë√∫ng

---

## 2. CHU·∫®N B·ªä TR∆Ø·ªöC KHI B·∫ÆT ƒê·∫¶U

### üì¶ Y√™u c·∫ßu
- ‚úÖ Spring Boot OAuth2 Client dependency (ƒë√£ c√≥ trong build.gradle.kts)
- ‚úÖ Apache Commons Lang3 (ƒë√£ c√≥)
- ‚úÖ Internet connection ƒë·ªÉ t·∫°o apps

### üîë Th√¥ng tin c·∫ßn thu th·∫≠p
1. **GitHub OAuth App**
   - Client ID
   - Client Secret
   - Redirect URI: `http://localhost:8080/api/v1/auth/oauth2/callback/github`

2. **Facebook App**
   - App ID (Client ID)
   - App Secret (Client Secret)
   - Redirect URI: `http://localhost:8080/api/v1/auth/oauth2/callback/facebook`

---

## 3. C√ÅC B∆Ø·ªöC CHI TI·∫æT

### üìç **B∆Ø·ªöC 1: T·∫°o GitHub OAuth App**

#### **M·ª•c ƒë√≠ch:** ƒêƒÉng k√Ω ·ª©ng d·ª•ng v·ªõi GitHub ƒë·ªÉ l·∫•y credentials

#### **C√°c b∆∞·ªõc:**
1. ƒêƒÉng nh·∫≠p v√†o GitHub
2. V√†o **Settings** ‚Üí **Developer settings** ‚Üí **OAuth Apps** ‚Üí **New OAuth App**
3. ƒêi·ªÅn th√¥ng tin:
   - **Application name:** `JobHunter Recruitment`
   - **Homepage URL:** `http://localhost:8080`
   - **Authorization callback URL:** `http://localhost:8080/api/v1/auth/oauth2/callback/github`
4. Click **Register application**
5. L∆∞u l·∫°i:
   - **Client ID**: V√≠ d·ª• `Iv1.abc123def456`
   - **Client Secret**: Click **Generate a new client secret** v√† l∆∞u l·∫°i

#### **‚ö†Ô∏è L∆∞u √Ω:**
- Callback URL ph·∫£i kh·ªõp ch√≠nh x√°c v·ªõi config trong `application.properties`
- Client Secret ch·ªâ hi·ªán 1 l·∫ßn, h√£y copy ngay

---

### üìç **B∆Ø·ªöC 2: T·∫°o Facebook App**

#### **M·ª•c ƒë√≠ch:** ƒêƒÉng k√Ω ·ª©ng d·ª•ng v·ªõi Facebook ƒë·ªÉ l·∫•y credentials

#### **C√°c b∆∞·ªõc:**
1. ƒêƒÉng nh·∫≠p v√†o [Facebook Developers](https://developers.facebook.com/)
2. V√†o **My Apps** ‚Üí **Create App**
3. Ch·ªçn **Consumer** ho·∫∑c **None** ‚Üí **Next**
4. ƒêi·ªÅn th√¥ng tin:
   - **App Name:** `JobHunter Recruitment`
   - **App Contact Email:** Email c·ªßa b·∫°n
5. Sau khi t·∫°o xong, v√†o **Settings** ‚Üí **Basic**
6. L∆∞u l·∫°i:
   - **App ID**: V√≠ d·ª• `123456789012345`
   - **App Secret**: Click **Show** v√† l∆∞u l·∫°i
7. V√†o **Products** ‚Üí **Facebook Login** ‚Üí **Settings**
8. Th√™m **Valid OAuth Redirect URIs:**
   ```
   http://localhost:8080/api/v1/auth/oauth2/callback/facebook
   ```
9. **Quan tr·ªçng:** V√†o **App Mode** ‚Üí Chuy·ªÉn sang **Live** mode (ho·∫∑c ƒë·ªÉ Development mode n·∫øu test)

#### **‚ö†Ô∏è L∆∞u √Ω:**
- Facebook y√™u c·∫ßu email permission: `email` v√† `public_profile`
- Ph·∫£i th√™m redirect URI ch√≠nh x√°c
- App ph·∫£i ·ªü Live mode ƒë·ªÉ user kh√°c login ƒë∆∞·ª£c

---

### üìç **B∆Ø·ªöC 3: C·∫•u h√¨nh Backend - application.properties**

#### **M·ª•c ƒë√≠ch:** Th√™m GitHub v√† Facebook OAuth2 client configuration

#### **File:** `src/main/resources/application.properties`

#### **Gi·∫£i th√≠ch:**
- Spring Boot OAuth2 Client t·ª± ƒë·ªông nh·∫≠n di·ªán provider name t·ª´ properties
- M·ªói provider c·∫ßn: `client-id`, `client-secret`, `scope`, `redirect-uri`
- Spring Security s·∫Ω t·ª± ƒë·ªông t·∫°o endpoint `/oauth2/authorize/{provider}`

#### **Code th√™m v√†o:**
```properties
# =========================================
# GITHUB OAUTH2 CLIENT PROPERTIES
# =========================================
spring.security.oauth2.client.registration.github.client-id=YOUR_GITHUB_CLIENT_ID
spring.security.oauth2.client.registration.github.client-secret=YOUR_GITHUB_CLIENT_SECRET
spring.security.oauth2.client.registration.github.scope=read:user, user:email
spring.security.oauth2.client.registration.github.redirect-uri=http://localhost:8080/api/v1/auth/oauth2/callback/github

# =========================================
# FACEBOOK OAUTH2 CLIENT PROPERTIES
# =========================================
spring.security.oauth2.client.registration.facebook.client-id=YOUR_FACEBOOK_APP_ID
spring.security.oauth2.client.registration.facebook.client-secret=YOUR_FACEBOOK_APP_SECRET
spring.security.oauth2.client.registration.facebook.scope=email, public_profile
spring.security.oauth2.client.registration.facebook.redirect-uri=http://localhost:8080/api/v1/auth/oauth2/callback/facebook
```

#### **‚ùó Thay th·∫ø:**
- `YOUR_GITHUB_CLIENT_ID` ‚Üí Client ID t·ª´ b∆∞·ªõc 1
- `YOUR_GITHUB_CLIENT_SECRET` ‚Üí Client Secret t·ª´ b∆∞·ªõc 1
- `YOUR_FACEBOOK_APP_ID` ‚Üí App ID t·ª´ b∆∞·ªõc 2
- `YOUR_FACEBOOK_APP_SECRET` ‚Üí App Secret t·ª´ b∆∞·ªõc 2

#### **üìù Gi·∫£i th√≠ch t·ª´ng tham s·ªë:**

| Tham s·ªë | M√¥ t·∫£ | GitHub | Facebook |
|---------|-------|--------|----------|
| `client-id` | ID ·ª©ng d·ª•ng | T·ª´ GitHub OAuth App | T·ª´ Facebook App Settings |
| `client-secret` | Secret key | T·ª´ GitHub OAuth App | T·ª´ Facebook App Settings |
| `scope` | Quy·ªÅn truy c·∫≠p | `read:user, user:email` | `email, public_profile` |
| `redirect-uri` | URL callback | Ph·∫£i kh·ªõp v·ªõi GitHub config | Ph·∫£i kh·ªõp v·ªõi Facebook config |

---

### üìç **B∆Ø·ªöC 4: X√°c minh SecurityConfiguration**

#### **M·ª•c ƒë√≠ch:** ƒê·∫£m b·∫£o SecurityConfiguration h·ªó tr·ª£ multi-provider

#### **File:** `src/main/java/com/example/jobhunter/config/SecurityConfiguration.java`

#### **Gi·∫£i th√≠ch:**
- Config hi·ªán t·∫°i ƒë√£ h·ªó tr·ª£ multi-provider
- `/oauth2/**` ƒë√£ ƒë∆∞·ª£c permitAll
- `oauth2Login()` t·ª± ƒë·ªông nh·∫≠n di·ªán t·∫•t c·∫£ provider t·ª´ properties
- `redirectionEndpoint` v·ªõi wildcard `*` h·ªó tr·ª£ t·∫•t c·∫£ providers

#### **‚úÖ Kh√¥ng c·∫ßn s·ª≠a g√¨!**

ƒêo·∫°n code n√†y ƒë√£ h·ªó tr·ª£ GitHub v√† Facebook:
```java
.oauth2Login(oauth2 -> oauth2
    .authorizationEndpoint(authz -> authz
        .baseUri("/oauth2/authorize")  // ‚Üê H·ªó tr·ª£ /oauth2/authorize/github v√† /oauth2/authorize/facebook
        .authorizationRequestRepository(cookieAuthorizationRequestRepository))
    .redirectionEndpoint(r -> r
        .baseUri("/api/v1/auth/oauth2/callback/*"))  // ‚Üê Wildcard * h·ªó tr·ª£ t·∫•t c·∫£ providers
    .successHandler(oAuth2AuthenticationSuccessHandler)
    .failureHandler(oAuth2AuthenticationFailureHandler))
```

---

### üìç **B∆Ø·ªöC 5: Ki·ªÉm tra Success Handler**

#### **M·ª•c ƒë√≠ch:** ƒê·∫£m b·∫£o handler x·ª≠ l√Ω ƒë√∫ng th√¥ng tin t·ª´ c√°c providers

#### **File:** `src/main/java/com/example/jobhunter/config/SecurityConfiguration.java`

#### **Gi·∫£i th√≠ch:**
Bean `oAuth2AuthenticationSuccessHandler` ƒë√£ x·ª≠ l√Ω chung cho t·∫•t c·∫£ providers:

```java
@Bean
public AuthenticationSuccessHandler oAuth2AuthenticationSuccessHandler(...) {
    return (request, response, authentication) -> {
        OidcUser oidcUser = (OidcUser) authentication.getPrincipal();
        String email = oidcUser.getEmail();
        String name = oidcUser.getFullName();
        
        // 1. T√¨m ho·∫∑c t·∫°o user
        // 2. T·∫°o JWT tokens
        // 3. Set refresh token cookie
        // 4. Redirect v·ªÅ frontend
    };
}
```

#### **‚ö†Ô∏è L·ªñI TI·ªÄM ·∫®N:**
GitHub v√† Facebook c√≥ th·ªÉ tr·∫£ v·ªÅ `name` b·∫±ng `null`. C·∫ßn x·ª≠ l√Ω:

#### **üîß Code c·∫ßn s·ª≠a trong Success Handler:**

T√¨m ƒëo·∫°n n√†y:
```java
OidcUser oidcUser = (OidcUser) authentication.getPrincipal();
String email = oidcUser.getEmail();
String name = oidcUser.getFullName();
```

**Thay b·∫±ng:**
```java
OidcUser oidcUser = (OidcUser) authentication.getPrincipal();
String email = oidcUser.getEmail();
String name = oidcUser.getFullName();

// ‚úÖ X·ª¨ L√ù: N·∫øu name null, l·∫•y t·ª´ preferred_username (GitHub) ho·∫∑c email
if (name == null || name.isEmpty()) {
    name = oidcUser.getPreferredUsername(); // GitHub tr·∫£ v·ªÅ login name
    if (name == null || name.isEmpty()) {
        name = email.split("@")[0]; // Fallback: l·∫•y ph·∫ßn tr∆∞·ªõc @ c·ªßa email
    }
}
```

#### **üìù Gi·∫£i th√≠ch:**
- **Google**: Lu√¥n c√≥ `fullName`
- **GitHub**: Kh√¥ng c√≥ `fullName`, nh∆∞ng c√≥ `login` (username)
- **Facebook**: C√≥ `name` trong attributes
- Code tr√™n ƒë·∫£m b·∫£o `name` kh√¥ng bao gi·ªù null

---

### üìç **B∆Ø·ªöC 6: C·∫≠p nh·∫≠t AuthService (Kh√¥ng b·∫Øt bu·ªôc)**

#### **M·ª•c ƒë√≠ch:** L∆∞u th√¥ng tin provider ƒë·ªÉ ph√¢n bi·ªát ngu·ªìn ƒëƒÉng k√Ω

#### **File:** `src/main/java/com/example/jobhunter/service/AuthService.java`

#### **Gi·∫£i th√≠ch:**
Hi·ªán t·∫°i method `registerOauthUser()` ch·ªâ nh·∫≠n `email` v√† `name`. N·∫øu mu·ªën l∆∞u provider (Google/GitHub/Facebook), c·∫ßn s·ª≠a.

#### **üîß Code c·∫ßn s·ª≠a (T√ôY CH·ªåN):**

**1. Th√™m tr∆∞·ªùng `provider` v√†o User entity (Kh√¥ng b·∫Øt bu·ªôc):**
```java
// File: src/main/java/com/example/jobhunter/domain/User.java
@Column(name = "provider")
private String provider; // VD: "GOOGLE", "GITHUB", "FACEBOOK"
```

**2. S·ª≠a method `registerOauthUser()`:**

**Code c≈©:**
```java
public User registerOauthUser(String email, String name) {
    // ...
    User newUser = new User();
    newUser.setName(name);
    newUser.setEmail(email);
    newUser.setPassWord(hashedPassword);
    
    return this.userService.handleSaveUser(newUser);
}
```

**Code m·ªõi (T√ôY CH·ªåN):**
```java
public User registerOauthUser(String email, String name, String provider) {
    // ...
    User newUser = new User();
    newUser.setName(name);
    newUser.setEmail(email);
    newUser.setPassWord(hashedPassword);
    newUser.setProvider(provider); // ‚úÖ TH√äM provider
    
    return this.userService.handleSaveUser(newUser);
}
```

**3. C·∫≠p nh·∫≠t Success Handler ƒë·ªÉ truy·ªÅn provider:**
```java
// File: SecurityConfiguration.java, trong oAuth2AuthenticationSuccessHandler
String provider = "GOOGLE"; // M·∫∑c ƒë·ªãnh

// ‚úÖ TH√äM: X√°c ƒë·ªãnh provider t·ª´ request
if (request.getRequestURI().contains("/github")) {
    provider = "GITHUB";
} else if (request.getRequestURI().contains("/facebook")) {
    provider = "FACEBOOK";
}

// G·ªçi method v·ªõi provider
user = authService.registerOauthUser(email, name, provider);
```

---

### üìç **B∆Ø·ªöC 7: X√°c minh Frontend Configuration**

#### **M·ª•c ƒë√≠ch:** ƒê·∫£m b·∫£o frontend ƒë√£ s·∫µn s√†ng cho GitHub v√† Facebook

#### **File:** `src/config/oauth.config.jsx`

#### **Gi·∫£i th√≠ch:**
Frontend ƒë√£ c√≥ s·∫µn config cho GitHub v√† Facebook. Ch·ªâ c·∫ßn ki·ªÉm tra:

```jsx
const OAUTH_CONFIG = {
    providers: {
        google: {
            authUrl: `${API_BASE_URL}/oauth2/authorize/google`,
            // ...
        },
        github: {
            authUrl: `${API_BASE_URL}/oauth2/authorization/github`, // ‚ö†Ô∏è Ch√∫ √Ω: "authorization" thay v√¨ "authorize"
            // ...
        },
        facebook: {
            authUrl: `${API_BASE_URL}/oauth2/authorization/facebook`, // ‚ö†Ô∏è Ch√∫ √Ω: "authorization" thay v√¨ "authorize"
            // ...
        },
    },
};
```

#### **üîß L·ªñI C·∫¶N S·ª¨A:**

**V·∫•n ƒë·ªÅ:** URL endpoint kh√¥ng nh·∫•t qu√°n
- Google: `/oauth2/authorize/google` ‚úÖ
- GitHub: `/oauth2/authorization/github` ‚ùå
- Facebook: `/oauth2/authorization/facebook` ‚ùå

**Spring Security m·∫∑c ƒë·ªãnh d√πng `/oauth2/authorization/{provider}`**, nh∆∞ng b·∫°n ƒë√£ custom th√†nh `/oauth2/authorize` trong SecurityConfiguration.

#### **Gi·∫£i ph√°p 1: S·ª≠a Frontend (ƒê·ªÄ XU·∫§T)**
```jsx
github: {
    authUrl: `${API_BASE_URL}/oauth2/authorize/github`, // ‚úÖ ƒê·ªïi th√†nh "authorize"
    // ...
},
facebook: {
    authUrl: `${API_BASE_URL}/oauth2/authorize/facebook`, // ‚úÖ ƒê·ªïi th√†nh "authorize"
    // ...
},
```

#### **Gi·∫£i ph√°p 2: S·ª≠a Backend**
```java
// File: SecurityConfiguration.java
.authorizationEndpoint(authz -> authz
    .baseUri("/oauth2/authorization") // ‚úÖ ƒê·ªïi th√†nh "authorization"
    .authorizationRequestRepository(cookieAuthorizationRequestRepository))
```

**üëâ Khuy·∫øn ngh·ªã: D√πng Gi·∫£i ph√°p 1 (s·ª≠a frontend) ƒë·ªÉ gi·ªØ nh·∫•t qu√°n v·ªõi Google.**

---

### üìç **B∆Ø·ªöC 8: Test t·ª´ng provider**

#### **M·ª•c ƒë√≠ch:** Ki·ªÉm tra t·ª´ng b∆∞·ªõc tr∆∞·ªõc khi deploy

#### **C√°c b∆∞·ªõc test:**

1. **Kh·ªüi ƒë·ªông backend:**
   ```bash
   ./gradlew bootRun
   ```

2. **Kh·ªüi ƒë·ªông frontend:**
   ```bash
   cd Recruitment_Frontend
   npm run dev
   ```

3. **Test Google (ƒë√£ c√≥):**
   - V√†o `http://localhost:5173/login`
   - Click n√∫t Google
   - X√°c minh redirect ƒë√∫ng
   - Check user ƒë∆∞·ª£c t·∫°o trong DB

4. **Test GitHub:**
   - Click n√∫t GitHub
   - ƒêƒÉng nh·∫≠p GitHub
   - Authorize app
   - X√°c minh redirect v·ªÅ frontend v·ªõi `?oauth=success`
   - Check console log: `‚úÖ OAuth2 success`
   - Check user trong DB c√≥ email t·ª´ GitHub

5. **Test Facebook:**
   - Click n√∫t Facebook
   - ƒêƒÉng nh·∫≠p Facebook
   - Authorize app
   - X√°c minh redirect v·ªÅ frontend
   - Check user trong DB

#### **üêõ Debug n·∫øu l·ªói:**

**L·ªói 1: "Cannot find provider"**
- Ki·ªÉm tra `application.properties` ƒë√£ c√≥ config GitHub/Facebook
- Restart backend sau khi s·ª≠a properties

**L·ªói 2: Redirect URI mismatch**
- Ki·ªÉm tra GitHub/Facebook app config
- ƒê·∫£m b·∫£o redirect URI gi·ªëng h·ªát: `http://localhost:8080/api/v1/auth/oauth2/callback/{provider}`

**L·ªói 3: "email is null"**
- GitHub: User ph·∫£i public email trong profile
- Facebook: Ph·∫£i request permission `email`

**L·ªói 4: Frontend kh√¥ng nh·∫≠n ƒë∆∞·ª£c data**
- Check browser console
- Check redirect URL c√≥ ch·ª©a `access_token`
- Check cookie `refresh_token` ƒë√£ ƒë∆∞·ª£c set

---

### üìç **B∆Ø·ªöC 9: X·ª≠ l√Ω edge cases**

#### **M·ª•c ƒë√≠ch:** X·ª≠ l√Ω c√°c tr∆∞·ªùng h·ª£p ƒë·∫∑c bi·ªát

#### **Case 1: User ƒë√£ t·ªìn t·∫°i v·ªõi email t·ª´ provider kh√°c**

**V√≠ d·ª•:** User ƒëƒÉng k√Ω b·∫±ng Google v·ªõi email `user@gmail.com`, sau ƒë√≥ login b·∫±ng GitHub v·ªõi c√πng email.

**Gi·∫£i ph√°p:**
- Success Handler ƒë√£ c√≥ check: `if (user == null)`
- N·∫øu user ƒë√£ t·ªìn t·∫°i, ch·ªâ t·∫°o token m·ªõi, kh√¥ng t·∫°o user m·ªõi
- ‚úÖ Kh√¥ng c·∫ßn s·ª≠a code

#### **Case 2: GitHub user kh√¥ng public email**

**V·∫•n ƒë·ªÅ:** GitHub API tr·∫£ v·ªÅ `email = null` n·∫øu user kh√¥ng public email.

**Gi·∫£i ph√°p:**
Th√™m v√†o Success Handler:
```java
String email = oidcUser.getEmail();
if (email == null || email.isEmpty()) {
    // Redirect v·ªÅ frontend v·ªõi error
    String redirectUrl = UriComponentsBuilder.fromUriString(frontendUrl + "/login")
            .queryParam("error", "Email not available. Please make your GitHub email public.")
            .build().toUriString();
    response.sendRedirect(redirectUrl);
    return;
}
```

#### **Case 3: Facebook email b·ªã hidden**

**V·∫•n ƒë·ªÅ:** User t·ª´ ch·ªëi permission `email` khi login Facebook.

**Gi·∫£i ph√°p:**
- Facebook s·∫Ω redirect v·ªõi error
- `oAuth2AuthenticationFailureHandler` ƒë√£ x·ª≠ l√Ω
- ‚úÖ Kh√¥ng c·∫ßn s·ª≠a code

---

## 4. LU·ªíNG HO·∫†T ƒê·ªòNG C·ª¶A OAUTH2

### üîÑ **Lu·ªìng t·ªïng quan**

```
[Frontend]  ‚Üí  [Backend]  ‚Üí  [GitHub/Facebook]  ‚Üí  [Backend]  ‚Üí  [Frontend]
    (1)          (2)              (3)                  (4)          (5)
```

### üìä **Chi ti·∫øt t·ª´ng b∆∞·ªõc:**

#### **B∆∞·ªõc 1: User click n√∫t GitHub/Facebook (Frontend)**
- File: `OAuthButtons.jsx`
- Action: `window.location.href = provider.authUrl`
- URL: `http://localhost:8080/oauth2/authorize/github`

#### **B∆∞·ªõc 2: Backend nh·∫≠n request v√† redirect sang provider (Backend)**
- Spring Security x·ª≠ l√Ω t·ª± ƒë·ªông
- T·∫°o `OAuth2AuthorizationRequest`
- L∆∞u v√†o cookie b·∫±ng `HttpCookieOAuth2AuthorizationRequestRepository`
- Redirect sang GitHub/Facebook v·ªõi `client_id`, `scope`, `redirect_uri`

#### **B∆∞·ªõc 3: User login t·∫°i GitHub/Facebook (External)**
- User ƒëƒÉng nh·∫≠p v√† cho ph√©p ·ª©ng d·ª•ng truy c·∫≠p
- GitHub/Facebook redirect v·ªÅ: `http://localhost:8080/api/v1/auth/oauth2/callback/github?code=ABC123`

#### **B∆∞·ªõc 4: Backend nh·∫≠n callback v√† x·ª≠ l√Ω (Backend)**
- Spring Security nh·∫≠n `code`
- ƒê·ªïi `code` l·∫•y `access_token` t·ª´ GitHub/Facebook
- G·ªçi API GitHub/Facebook l·∫•y user info
- G·ªçi `oAuth2AuthenticationSuccessHandler`:
  - T√¨m ho·∫∑c t·∫°o user trong DB
  - T·∫°o JWT tokens
  - Set refresh token cookie
  - Redirect v·ªÅ frontend: `http://localhost:5173/login?oauth=success&access_token=JWT123`

#### **B∆∞·ªõc 5: Frontend nh·∫≠n k·∫øt qu·∫£ (Frontend)**
- File: `LoginPage.jsx`
- ƒê·ªçc query params: `oauth=success`, `access_token=JWT123`
- L∆∞u token v√†o context
- Redirect sang `/dashboard`

### üóÇÔ∏è **S∆° ƒë·ªì file tham gia:**

```
Frontend:
‚îú‚îÄ‚îÄ OAuthButtons.jsx          # Render n√∫t, handle click
‚îú‚îÄ‚îÄ oauth.config.jsx          # Config provider URLs
‚îú‚îÄ‚îÄ LoginPage.jsx             # Nh·∫≠n k·∫øt qu·∫£ redirect
‚îî‚îÄ‚îÄ AuthContext.jsx           # L∆∞u token, user state

Backend:
‚îú‚îÄ‚îÄ application.properties                           # Config OAuth2 clients
‚îú‚îÄ‚îÄ SecurityConfiguration.java                       # Config oauth2Login
‚îú‚îÄ‚îÄ HttpCookieOAuth2AuthorizationRequestRepository  # L∆∞u OAuth2 request v√†o cookie
‚îú‚îÄ‚îÄ oAuth2AuthenticationSuccessHandler              # X·ª≠ l√Ω th√†nh c√¥ng
‚îú‚îÄ‚îÄ oAuth2AuthenticationFailureHandler              # X·ª≠ l√Ω th·∫•t b·∫°i
‚îî‚îÄ‚îÄ AuthService.java                                 # T·∫°o user m·ªõi
```

---

## 5. T·ªîNG K·∫æT C√ÅC FILE ƒê√É S·ª¨A ƒê·ªîI

### ‚úÖ **Files c·∫ßn s·ª≠a:**

| # | File | M·ª•c ƒë√≠ch | Thay ƒë·ªïi |
|---|------|----------|----------|
| 1 | `application.properties` | Th√™m GitHub & Facebook config | **B·∫ÆT BU·ªòC** |
| 2 | `oauth.config.jsx` | S·ª≠a URL endpoint | **B·∫ÆT BU·ªòC** |
| 3 | `SecurityConfiguration.java` | X·ª≠ l√Ω name null | **KHUY·∫æN NGH·ªä** |
| 4 | `AuthService.java` | Th√™m provider field | **T√ôY CH·ªåN** |
| 5 | `User.java` | Th√™m tr∆∞·ªùng provider | **T√ôY CH·ªåN** |

### üìù **Chi ti·∫øt thay ƒë·ªïi:**

#### **1. application.properties (B·∫ÆT BU·ªòC)**
```properties
# Th√™m v√†o cu·ªëi file
spring.security.oauth2.client.registration.github.client-id=YOUR_GITHUB_CLIENT_ID
spring.security.oauth2.client.registration.github.client-secret=YOUR_GITHUB_CLIENT_SECRET
spring.security.oauth2.client.registration.github.scope=read:user, user:email
spring.security.oauth2.client.registration.github.redirect-uri=http://localhost:8080/api/v1/auth/oauth2/callback/github

spring.security.oauth2.client.registration.facebook.client-id=YOUR_FACEBOOK_APP_ID
spring.security.oauth2.client.registration.facebook.client-secret=YOUR_FACEBOOK_APP_SECRET
spring.security.oauth2.client.registration.facebook.scope=email, public_profile
spring.security.oauth2.client.registration.facebook.redirect-uri=http://localhost:8080/api/v1/auth/oauth2/callback/facebook
```

#### **2. oauth.config.jsx (B·∫ÆT BU·ªòC)**
```jsx
// S·ª≠a d√≤ng authUrl
github: {
    authUrl: `${API_BASE_URL}/oauth2/authorize/github`, // ‚úÖ ƒê·ªïi th√†nh "authorize"
    // ... gi·ªØ nguy√™n ph·∫ßn c√≤n l·∫°i
},
facebook: {
    authUrl: `${API_BASE_URL}/oauth2/authorize/facebook`, // ‚úÖ ƒê·ªïi th√†nh "authorize"
    // ... gi·ªØ nguy√™n ph·∫ßn c√≤n l·∫°i
},
```

#### **3. SecurityConfiguration.java (KHUY·∫æN NGH·ªä)**
```java
// T√¨m d√≤ng n√†y trong oAuth2AuthenticationSuccessHandler
String name = oidcUser.getFullName();

// Th√™m x·ª≠ l√Ω null
if (name == null || name.isEmpty()) {
    name = oidcUser.getPreferredUsername();
    if (name == null || name.isEmpty()) {
        name = email.split("@")[0];
    }
}
```

---

## 6. CHECKLIST HO√ÄN TH√ÄNH

### üìã Tr∆∞·ªõc khi test:
- [ ] T·∫°o GitHub OAuth App v√† l·∫•y credentials
- [ ] T·∫°o Facebook App v√† l·∫•y credentials
- [ ] Th√™m config v√†o `application.properties`
- [ ] S·ª≠a `oauth.config.jsx` (authUrl)
- [ ] S·ª≠a `SecurityConfiguration.java` (x·ª≠ l√Ω name null)
- [ ] Restart backend v√† frontend

### üìã Test t·ª´ng provider:
- [ ] Test Google login (ƒë√£ c√≥ - verify l·∫°i)
- [ ] Test GitHub login
  - [ ] Click n√∫t GitHub
  - [ ] Authorize th√†nh c√¥ng
  - [ ] Redirect v·ªÅ frontend
  - [ ] User ƒë∆∞·ª£c t·∫°o trong DB
- [ ] Test Facebook login
  - [ ] Click n√∫t Facebook
  - [ ] Authorize th√†nh c√¥ng
  - [ ] Redirect v·ªÅ frontend
  - [ ] User ƒë∆∞·ª£c t·∫°o trong DB

### üìã Test edge cases:
- [ ] User ƒë√£ t·ªìn t·∫°i v·ªõi c√πng email
- [ ] GitHub user kh√¥ng public email
- [ ] Facebook user t·ª´ ch·ªëi email permission
- [ ] Network error khi g·ªçi API provider

---

## 7. TROUBLESHOOTING

### ‚ùå **L·ªói th∆∞·ªùng g·∫∑p:**

#### **1. "redirect_uri_mismatch"**
**Nguy√™n nh√¢n:** Redirect URI kh√¥ng kh·ªõp gi·ªØa app config v√† code

**Gi·∫£i ph√°p:**
- GitHub: Ki·ªÉm tra GitHub OAuth App settings
- Facebook: Ki·ªÉm tra Facebook Login ‚Üí Valid OAuth Redirect URIs
- ƒê·∫£m b·∫£o URI gi·ªëng h·ªát (c√≥/kh√¥ng c√≥ trailing slash)

#### **2. "Cannot find provider: github"**
**Nguy√™n nh√¢n:** Backend ch∆∞a load config t·ª´ application.properties

**Gi·∫£i ph√°p:**
- Restart Spring Boot application
- Ki·ªÉm tra properties c√≥ syntax error kh√¥ng
- Check log khi startup: `OAuth2ClientRegistration`

#### **3. "Email is null"**
**Nguy√™n nh√¢n:** 
- GitHub: User ch∆∞a public email
- Facebook: User t·ª´ ch·ªëi permission email

**Gi·∫£i ph√°p:**
- Th√™m validation trong Success Handler (xem B∆∞·ªõc 9)
- Hi·ªÉn th·ªã error message cho user

#### **4. Frontend kh√¥ng nh·∫≠n ƒë∆∞·ª£c token**
**Nguy√™n nh√¢n:** Redirect URL thi·∫øu access_token

**Gi·∫£i ph√°p:**
- Check redirect URL trong Success Handler
- ƒê·∫£m b·∫£o: `.queryParam("access_token", accessToken)`
- Check browser console log

---

## 8. NH·ªÆNG G√å ƒê√É L√ÄM ƒê∆Ø·ª¢C

### ‚úÖ **K·∫øt qu·∫£:**
1. ‚úÖ Th√™m GitHub OAuth2 login v√†o h·ªá th·ªëng
2. ‚úÖ Th√™m Facebook OAuth2 login v√†o h·ªá th·ªëng
3. ‚úÖ T√°i s·ª≠ d·ª•ng 100% logic hi·ªán c√≥ (SecurityConfiguration, AuthService)
4. ‚úÖ Frontend h·ªó tr·ª£ 3 providers: Google, GitHub, Facebook
5. ‚úÖ X·ª≠ l√Ω edge cases: name null, email null
6. ‚úÖ Stateless authentication (JWT + refresh token cookie)

### üéØ **So s√°nh tr∆∞·ªõc v√† sau:**

| T√≠nh nƒÉng | Tr∆∞·ªõc | Sau |
|-----------|-------|-----|
| OAuth2 Providers | Ch·ªâ Google | Google + GitHub + Facebook |
| Backend Config | 1 provider | 3 providers (d·ªÖ m·ªü r·ªông) |
| Frontend UI | 1 n√∫t | 3 n√∫t (horizontal layout) |
| User Creation | Ch·ªâ Google users | T·∫•t c·∫£ OAuth users |
| Edge Case Handling | C∆° b·∫£n | X·ª≠ l√Ω name null, email null |

---

## 9. M·ªû R·ªòNG SAU N√ÄY

### üöÄ **T√≠nh nƒÉng n√¢ng cao:**

1. **Th√™m provider m·ªõi (LinkedIn, Twitter/X)**
   - Ch·ªâ c·∫ßn th√™m config v√†o `application.properties`
   - Th√™m icon v√†o `oauth.config.jsx`

2. **L∆∞u provider v√†o DB**
   - Th√™m tr∆∞·ªùng `provider` v√†o User entity
   - Hi·ªÉn th·ªã "Login with Google/GitHub/Facebook" khi user ƒë√£ c√≥ account

3. **Link multiple providers**
   - Cho ph√©p user link nhi·ªÅu OAuth accounts v√†o 1 user
   - V√≠ d·ª•: User ƒëƒÉng k√Ω b·∫±ng email, sau ƒë√≥ link Google v√† GitHub

4. **Custom scope cho t·ª´ng provider**
   - GitHub: Th√™m `repo` scope ƒë·ªÉ ƒë·ªçc repositories
   - Facebook: Th√™m `user_friends` ƒë·ªÉ l·∫•y danh s√°ch b·∫°n b√®

---

## üìû H·ªñ TR·ª¢

N·∫øu g·∫∑p v·∫•n ƒë·ªÅ, h√£y check:
1. Backend log: `./gradlew bootRun`
2. Browser console: F12 ‚Üí Console
3. Network tab: Check request/response c·ªßa OAuth2

**Debug checklist:**
- [ ] Credentials ƒë√∫ng trong application.properties
- [ ] Redirect URI kh·ªõp ch√≠nh x√°c
- [ ] Backend ƒë√£ restart sau khi s·ª≠a properties
- [ ] Frontend authUrl ƒë√∫ng (authorize vs authorization)

---

## üìö T√ÄI LI·ªÜU THAM KH·∫¢O

- [Spring Security OAuth2 Client](https://docs.spring.io/spring-security/reference/servlet/oauth2/client/index.html)
- [GitHub OAuth Apps](https://docs.github.com/en/apps/oauth-apps)
- [Facebook Login](https://developers.facebook.com/docs/facebook-login/)

---

**üéâ Ch√∫c b·∫°n th√†nh c√¥ng!**
